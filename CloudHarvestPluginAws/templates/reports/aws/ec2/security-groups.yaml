report:
  name: reports.aws.ec2.security_groups
  description: This report provides information on EC2 security_groups across all regions and accounts.

  headers:
    - Active
    - Account
    - Region
    - Group
    - Vpc
    - EgressProtocol
    - EgressFrom
    - EgressTo
    - EgressIp4
    - EgressIp6
    - IngressProtocol
    - IngressFrom
    - IngressTo
    - IngressIp4
    - IngressIp6

  tasks:
    - mongo:
        name: get ec2 security groups
        silo: harvest-core
        collection: aws.ec2.security-groups
        filters: '.*'

        pipeline:
          - $project:
              Active: "$Harvest.Active"
              Account: "$Harvest.Account"
              Region: "$Harvest.Region"
              Group: "$SecurityGroupName"
              Vpc: "$VpcId"
              EgressProtocol: "$IpPermissionsEgress.IpProtocol"
              EgressFrom: "$IpPermissionsEgress.FromPort"
              EgressTo: "$IpPermissionsEgress.ToPort"
              EgressIp4: "$IpPermissionsEgress.IpRanges"      # Returns a list
              EgressIp6: "$IpPermissionsEgress.Ipv6Ranges"    # Returns a list
              IngressProtocol: "$IpPermissions.IpProtocol"
              IngressFrom: "$IpPermissions.FromPort"
              IngressTo: "$IpPermissions.ToPort"
              IngressIp4: "$IpPermissions.IpRanges"           # Returns a list
              IngressIp6: "$IpPermissions.Ipv6Ranges"         # Returns a list

