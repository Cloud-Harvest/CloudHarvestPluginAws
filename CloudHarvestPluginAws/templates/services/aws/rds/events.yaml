harvest:
  name: services.aws.rds.events
  description: Retrieve information about RDS events
  unique_identifier_keys:
    - Harvest.Platform
    - Harvest.Service
    - Harvest.Type
    - Harvest.Account
    - Harvest.Region
    - Date
    - SourceIdentifier
    - SourceType

  indexes:
    - keys: SourceIdentifier
    - keys: SourceType

  tasks:
    all:
      - set:
          name: Set the EndTime
          identifier: now_datetime
          value: '{{ datetime_now().isoformat() }}'
          cast: datetime

      - set:
          name: Set the StartTime
          identifier: past_datetime
          value: '{{ datetime_ago(days=13, hours=23, minutes=50).isoformat() }}'
          cast: datetime

      - aws: &describe_db_clusters
          name: Retrieve RDS Events
          command: describe_events
          arguments:
            StartTime: var.past_datetime
            EndTime: var.now_datetime

    # tasks to collect a single cluster
    single:
      - <<: *describe_db_clusters
        arguments:
          SourceIdentifier: var.identifier
